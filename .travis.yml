language: scala

scala:
  - 2.13.3

jdk:
  - openjdk11

services:
  - docker

sudo: false
addons:
  apt:
    packages:
      - graphviz

cache:
  directories:
    - $HOME/.cache/coursier
    - $HOME/.ivy2/cache
    - $HOME/.sbt

branches:
  except:
    - /^pr\..*/

before_install:
  script:
    - docker-compose up -d
    # Verify service availability
    - docker-compose ps
  after_success:
    - deactivate

jobs:
  include:
    - stage: "Tests"
      name: "Unit Tests"
      script: sbt ++$TRAVIS_SCALA_VERSION test
    - stage: "Integraton tests"
      name: "Integraton test"
      script: sbt ++$TRAVIS_SCALA_VERSION it:test

